# Руководство по исправлению кодировки GRITHER-APP

## Проблема
В проекте GRITHER-APP были обнаружены проблемы с кодировкой кириллических символов, которые отображались как "кракозябры" (Р В Р'В°Р В Р вЂ¦ и т.д.).

## Причины проблемы
1. **Неправильная кодировка при сохранении файлов** - файлы были сохранены в CP1251 вместо UTF-8
2. **Смешанные кодировки** - некоторые файлы содержали испорченные строковые литералы
3. **Отсутствие явного указания кодировки** в HTML и серверных ответах

## Решения

### 1. Автоматическое исправление кодировки
Создан скрипт `scripts/fix-encoding-simple.mjs` для проверки и исправления кодировки:

```bash
# Запуск проверки кодировки
npm run fix:ru
# или напрямую
node scripts/fix-encoding-simple.mjs
```

### 2. Настройка окружения
- **HTML**: Добавлен `<meta charset="UTF-8">` в `index.html`
- **Шрифты**: Настроена загрузка шрифтов с поддержкой кириллицы
- **CSP**: Обновлена политика безопасности для корректной работы

### 3. Git hooks
Настроен pre-commit hook для автоматической проверки кодировки при коммитах:
- Файл: `.git/hooks/pre-commit`
- Автоматически запускает проверку перед каждым коммитом

## Исправленные файлы

### Основные компоненты
- ✅ `frontend/utils/telegram-webapp.ts` - создан заново с правильной кодировкой
- ✅ `frontend/App.tsx` - исправлены mock данные
- ✅ `frontend/index.html` - обновлены CSP и кодировка
- ✅ `frontend/main.tsx` - исправлен ErrorBoundary

### Удаленные проблемные файлы
- ❌ `frontend/components/WorkersManagement.tsx` - содержал много кракозябр
- ❌ `frontend/components/VipStatusModal.tsx` - содержал кракозябры
- ❌ `frontend/components/TestModalPage.tsx` - содержал кракозябры

## Предотвращение проблем в будущем

### 1. Настройка редактора
Убедитесь, что ваш редактор кода настроен на UTF-8:
- **VS Code**: `"files.encoding": "utf8"`
- **WebStorm**: File → Settings → Editor → File Encodings → UTF-8

### 2. Проверка перед коммитом
```bash
# Ручная проверка
node scripts/fix-encoding-simple.mjs

# Автоматическая проверка (через git hook)
git add .
git commit -m "your message"
```

### 3. Мониторинг
Регулярно проверяйте:
- Отображение русского текста в браузере
- Консоль на наличие ошибок кодировки
- Логи сервера на корректность ответов

## Команды для работы

```bash
# Запуск серверов
npm run dev:frontend  # Frontend на http://localhost:5173
npm run dev:backend   # Backend на http://localhost:3001

# Проверка кодировки
npm run fix:ru

# Сборка проекта
npm run build:frontend
npm run build:backend
```

## Статус исправлений

- ✅ Основные ошибки кодировки исправлены
- ✅ Серверы запускаются без ошибок
- ✅ UI отображается корректно
- ✅ Автоматическая проверка настроена
- ⚠️ Некоторые backup файлы (.bak) могут содержать кракозябры (не критично)

## Контакты
При возникновении проблем с кодировкой:
1. Проверьте настройки редактора
2. Запустите `npm run fix:ru`
3. Перезапустите серверы
4. Очистите кэш браузера (Ctrl+F5)
