import React, { useState, useEffect } from 'react';
import { 
  Search, 
  Filter, 
  Eye, 
  Crown,
  X,
  Clock,
  DollarSign,
  Users,
  AlertTriangle,
  CheckCircle,
  Ban,
  RefreshCw,
  Trophy,
  Calendar,
  TrendingUp,
  Activity
} from 'lucide-react';
import { databaseService, BattleData } from '../services/database';
import { useAdminDatabase } from '../hooks/useAdminDatabase';

interface AdminBattleManagementProps {
  theme: 'light' | 'dark';
}

// Р ВРЎРѓР С—Р С•Р В»РЎРЉР В·РЎС“Р ВµР С BattleData Р С‘Р В· Р В±Р В°Р В·РЎвЂ№ Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦

interface BattleStats {
  totalBattles: number;
  activeBattles: number;
  completedBattles: number;
  disputedBattles: number;
  totalVolume: number;
  averageStake: number;
  topPlayers: Array<{
    name: string;
    wins: number;
    totalWinnings: number;
  }>;
}

const BATTLE_STATUS = {
  active: { label: 'Р С’Р С”РЎвЂљР С‘Р Р†Р Р…РЎвЂ№Р в„–', color: 'bg-yellow-500' },
  completed: { label: 'Р вЂ”Р В°Р Р†Р ВµРЎР‚РЎв‚¬Р ВµР Р…', color: 'bg-green-500' },
  cancelled: { label: 'Р С›РЎвЂљР СР ВµР Р…Р ВµР Р…', color: 'bg-red-500' },
  disputed: { label: 'Р РЋР С—Р С•РЎР‚Р Р…РЎвЂ№Р в„–', color: 'bg-orange-500' }
};

export const AdminBattleManagement: React.FC<AdminBattleManagementProps> = ({ theme }) => {
  const [battles, setBattles] = useState<Battle[]>([]);
  const [filteredBattles, setFilteredBattles] = useState<Battle[]>([]);
  const [stats, setStats] = useState<BattleStats>({
    totalBattles: 0,
    activeBattles: 0,
    completedBattles: 0,
    disputedBattles: 0,
    totalVolume: 0,
    averageStake: 0,
    topPlayers: []
  });
  const [searchQuery, setSearchQuery] = useState('');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [activeTab, setActiveTab] = useState<'active' | 'history' | 'disputes'>('active');
  const [selectedBattle, setSelectedBattle] = useState<Battle | null>(null);

  // Р вЂ”Р В°Р С–РЎР‚РЎС“Р В·Р С”Р В° Р Т‘Р В°Р Р…Р Р…РЎвЂ№РЎвЂ¦
  useEffect(() => {
    loadBattles();
  }, []);

  // Р В¤Р С‘Р В»РЎРЉРЎвЂљРЎР‚Р В°РЎвЂ Р С‘РЎРЏ
  useEffect(() => {
    filterBattles();
  }, [battles, searchQuery, filterStatus, activeTab]);

  const loadBattles = async () => {
    // Mock Р Т‘Р В°Р Р…Р Р…РЎвЂ№Р Вµ
    const mockBattles: Battle[] = [
      {
        id: '1',
        player1: {
          id: 'user1',
          name: 'Р С’Р В»Р ВµР С”РЎРѓР ВµР в„– Р ВР Р†Р В°Р Р…Р С•Р Р†',
          team: 'Р С™Р С•Р СР В°Р Р…Р Т‘Р В° Р С’',
          balance: 1000
        },
        player2: {
          id: 'user2',
          name: 'Р СљР В°РЎР‚Р С‘РЎРЏ Р СџР ВµРЎвЂљРЎР‚Р С•Р Р†Р В°',
          team: 'Р С™Р С•Р СР В°Р Р…Р Т‘Р В° Р вЂ',
          balance: 750
        },
        stake: 250,
        status: 'active',
        createdAt: '2024-01-21T14:30:00Z'
      },
      {
        id: '2',
        player1: {
          id: 'user3',
          name: 'Р вЂќР СР С‘РЎвЂљРЎР‚Р С‘Р в„– Р РЋР С‘Р Т‘Р С•РЎР‚Р С•Р Р†',
          team: 'Р С™Р С•Р СР В°Р Р…Р Т‘Р В° Р вЂ™',
          balance: 500
        },
        player2: {
          id: 'user4',
          name: 'Р С’Р Р…Р Р…Р В° Р С™Р С•Р В·Р В»Р С•Р Р†Р В°',
          team: 'Р С™Р С•Р СР В°Р Р…Р Т‘Р В° Р вЂњ',
          balance: 1200
        },
        stake: 300,
        status: 'completed',
        winner: 'user4',
        createdAt: '2024-01-20T16:45:00Z',
        completedAt: '2024-01-20T17:15:00Z'
      },
      {
        id: '3',
        player1: {
          id: 'user5',
          name: 'Р СџР ВµРЎвЂљРЎР‚ Р СџР ВµРЎвЂљРЎР‚Р С•Р Р†',
          team: 'Р С™Р С•Р СР В°Р Р…Р Т‘Р В° Р вЂќ',
          balance: 800
        },
        player2: {
          id: 'user6',
          name: 'Р вЂўР В»Р ВµР Р…Р В° Р СљР С•РЎР‚Р С•Р В·Р С•Р Р†Р В°',
          team: 'Р С™Р С•Р СР В°Р Р…Р Т‘Р В° Р вЂў',
          balance: 600
        },
        stake: 200,
        status: 'disputed',
        disputeReason: 'Р СџР С•Р Т‘Р С•Р В·РЎР‚Р ВµР Р…Р С‘Р Вµ Р Р…Р В° РЎвЂЎР С‘РЎвЂљРЎвЂ№',
        proof: ['proof1.jpg', 'proof2.jpg'],
        createdAt: '2024-01-19T10:20:00Z'
      }
    ];

    setBattles(mockBattles);

    // Р В Р В°РЎРѓРЎвЂЎР ВµРЎвЂљ РЎРѓРЎвЂљР В°РЎвЂљР С‘РЎРѓРЎвЂљР С‘Р С”Р С‘
    const totalBattles = mockBattles.length;
    const activeBattles = mockBattles.filter(b => b.status === 'active').length;
    const completedBattles = mockBattles.filter(b => b.status === 'completed').length;
    const disputedBattles = mockBattles.filter(b => b.status === 'disputed').length;
    const totalVolume = mockBattles.reduce((sum, b) => sum + b.stake, 0);
    const averageStake = totalVolume / totalBattles;

    setStats({
      totalBattles,
      activeBattles,
      completedBattles,
      disputedBattles,
      totalVolume,
      averageStake,
      topPlayers: [
        { name: 'Р С’Р Р…Р Р…Р В° Р С™Р С•Р В·Р В»Р С•Р Р†Р В°', wins: 5, totalWinnings: 1500 },
        { name: 'Р С’Р В»Р ВµР С”РЎРѓР ВµР в„– Р ВР Р†Р В°Р Р…Р С•Р Р†', wins: 4, totalWinnings: 1200 },
        { name: 'Р вЂќР СР С‘РЎвЂљРЎР‚Р С‘Р в„– Р РЋР С‘Р Т‘Р С•РЎР‚Р С•Р Р†', wins: 3, totalWinnings: 900 }
      ]
    });
  };

  const filterBattles = () => {
    let filtered = battles;

    // Р В¤Р С‘Р В»РЎРЉРЎвЂљРЎР‚ Р С—Р С• РЎвЂљР В°Р В±РЎС“
    if (activeTab === 'active') {
      filtered = filtered.filter(b => b.status === 'active');
    } else if (activeTab === 'history') {
      filtered = filtered.filter(b => b.status === 'completed');
    } else if (activeTab === 'disputes') {
      filtered = filtered.filter(b => b.status === 'disputed');
    }

    // Р СџР С•Р С‘РЎРѓР С”
    if (searchQuery) {
      filtered = filtered.filter(battle =>
        battle.player1.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        battle.player2.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        battle.id.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // Р В¤Р С‘Р В»РЎРЉРЎвЂљРЎР‚ Р С—Р С• РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓРЎС“
    if (filterStatus !== 'all') {
      filtered = filtered.filter(battle => battle.status === filterStatus);
    }

    setFilteredBattles(filtered);
  };

  const handleBattleAction = async (battleId: string, action: string, winnerId?: string) => {
    const battle = battles.find(b => b.id === battleId);
    if (!battle) return;

    let updatedBattle: Battle;

    switch (action) {
      case 'complete':
        if (!winnerId) return;
        updatedBattle = {
          ...battle,
          status: 'completed' as const,
          winner: winnerId,
          completedAt: new Date().toISOString()
        };
        break;
      case 'cancel':
        updatedBattle = {
          ...battle,
          status: 'cancelled' as const,
          completedAt: new Date().toISOString()
        };
        break;
      case 'resolve_dispute':
        updatedBattle = {
          ...battle,
          status: 'completed' as const,
          winner: winnerId,
          completedAt: new Date().toISOString()
        };
        break;
      default:
        return;
    }

    setBattles(prev => prev.map(b => b.id === battleId ? updatedBattle : b));
    setSelectedBattle(null);
  };

  const getStatusColor = (status: string) => {
    return BATTLE_STATUS[status as keyof typeof BATTLE_STATUS]?.color || 'bg-gray-500';
  };

  const getStatusLabel = (status: string) => {
    return BATTLE_STATUS[status as keyof typeof BATTLE_STATUS]?.label || status;
  };

  const renderActiveBattles = () => (
    <div className="space-y-4">
      {filteredBattles.map((battle) => (
        <div
          key={battle.id}
          className="p-4 rounded-xl"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="text-center">
                <div className="p-3 rounded-lg bg-blue-500 bg-opacity-20 mb-2">
                  <Users className="w-6 h-6 text-blue-500" />
                </div>
                <div className="text-sm font-medium" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
                  {battle.player1.name}
                </div>
                <div className="text-xs opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  {battle.player1.team}
                </div>
                <div className="text-xs opacity-60">
                  СЂСџвЂ™В° {battle.player1.balance}
                </div>
              </div>

              <div className="text-center">
                <div className="text-lg font-bold" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
                  VS
                </div>
                <div className="text-sm opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  Р РЋРЎвЂљР В°Р Р†Р С”Р В°: {battle.stake} Р СР С•Р Р…Р ВµРЎвЂљ
                </div>
                <div className="text-xs opacity-60">
                  СЂСџвЂњвЂ¦ {new Date(battle.createdAt).toLocaleString()}
                </div>
              </div>

              <div className="text-center">
                <div className="p-3 rounded-lg bg-red-500 bg-opacity-20 mb-2">
                  <Users className="w-6 h-6 text-red-500" />
                </div>
                <div className="text-sm font-medium" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
                  {battle.player2.name}
                </div>
                <div className="text-xs opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  {battle.player2.team}
                </div>
                <div className="text-xs opacity-60">
                  СЂСџвЂ™В° {battle.player2.balance}
                </div>
              </div>
            </div>

            <div className="flex items-center space-x-2">
              <button
                onClick={() => handleBattleAction(battle.id, 'complete', battle.player1.id)}
                className="flex items-center space-x-1 px-3 py-1 rounded-lg bg-green-500 bg-opacity-20 text-green-500 hover:bg-opacity-30 text-sm"
              >
                <Crown className="w-4 h-4" />
                <span>{battle.player1.name}</span>
              </button>
              <button
                onClick={() => handleBattleAction(battle.id, 'complete', battle.player2.id)}
                className="flex items-center space-x-1 px-3 py-1 rounded-lg bg-green-500 bg-opacity-20 text-green-500 hover:bg-opacity-30 text-sm"
              >
                <Crown className="w-4 h-4" />
                <span>{battle.player2.name}</span>
              </button>
              <button
                onClick={() => handleBattleAction(battle.id, 'cancel')}
                className="flex items-center space-x-1 px-3 py-1 rounded-lg bg-red-500 bg-opacity-20 text-red-500 hover:bg-opacity-30 text-sm"
              >
                <X className="w-4 h-4" />
                <span>Р С›РЎвЂљР СР ВµР Р…Р С‘РЎвЂљРЎРЉ</span>
              </button>
            </div>
          </div>
        </div>
      ))}
    </div>
  );

  const renderBattleHistory = () => (
    <div className="space-y-4">
      {filteredBattles.map((battle) => (
        <div
          key={battle.id}
          className="p-4 rounded-xl"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="text-center">
                <div className={`p-3 rounded-lg mb-2 ${
                  battle.winner === battle.player1.id ? 'bg-green-500 bg-opacity-20' : 'bg-gray-500 bg-opacity-20'
                }`}>
                  <Users className={`w-6 h-6 ${
                    battle.winner === battle.player1.id ? 'text-green-500' : 'text-gray-500'
                  }`} />
                </div>
                <div className="text-sm font-medium" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
                  {battle.player1.name}
                </div>
                <div className="text-xs opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  {battle.player1.team}
                </div>
              </div>

              <div className="text-center">
                <div className="text-lg font-bold" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
                  VS
                </div>
                <div className="text-sm opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  Р РЋРЎвЂљР В°Р Р†Р С”Р В°: {battle.stake} Р СР С•Р Р…Р ВµРЎвЂљ
                </div>
                <div className="text-xs opacity-60">
                  СЂСџвЂњвЂ¦ {new Date(battle.createdAt).toLocaleString()}
                </div>
              </div>

              <div className="text-center">
                <div className={`p-3 rounded-lg mb-2 ${
                  battle.winner === battle.player2.id ? 'bg-green-500 bg-opacity-20' : 'bg-gray-500 bg-opacity-20'
                }`}>
                  <Users className={`w-6 h-6 ${
                    battle.winner === battle.player2.id ? 'text-green-500' : 'text-gray-500'
                  }`} />
                </div>
                <div className="text-sm font-medium" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
                  {battle.player2.name}
                </div>
                <div className="text-xs opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  {battle.player2.team}
                </div>
              </div>
            </div>

            <div className="flex items-center space-x-2">
              <span className={`px-2 py-1 rounded-full text-xs ${getStatusColor(battle.status)} text-white`}>
                {getStatusLabel(battle.status)}
              </span>
              {battle.winner && (
                <div className="flex items-center space-x-1 text-sm text-green-500">
                  <Trophy className="w-4 h-4" />
                  <span>
                    {battle.winner === battle.player1.id ? battle.player1.name : battle.player2.name}
                  </span>
                </div>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>
  );

  const renderDisputes = () => (
    <div className="space-y-4">
      {filteredBattles.map((battle) => (
        <div
          key={battle.id}
          className="p-4 rounded-xl border-l-4 border-orange-500"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="p-3 rounded-lg bg-orange-500 bg-opacity-20">
                <AlertTriangle className="w-6 h-6 text-orange-500" />
              </div>
              
              <div>
                <h3 className="font-semibold" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
                  Р вЂР В°РЎвЂљРЎвЂљР В» #{battle.id}
                </h3>
                <p className="text-sm opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  {battle.player1.name} vs {battle.player2.name}
                </p>
                <p className="text-sm opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
                  Р СџРЎР‚Р С‘РЎвЂЎР С‘Р Р…Р В°: {battle.disputeReason}
                </p>
                <div className="flex items-center space-x-4 mt-2 text-xs opacity-60">
                  <span>СЂСџвЂ™В° Р РЋРЎвЂљР В°Р Р†Р С”Р В°: {battle.stake} Р СР С•Р Р…Р ВµРЎвЂљ</span>
                  <span>СЂСџвЂњвЂ¦ {new Date(battle.createdAt).toLocaleString()}</span>
                  {battle.proof && (
                    <span>СЂСџвЂњР‹ Р вЂќР С•Р С”Р В°Р В·Р В°РЎвЂљР ВµР В»РЎРЉРЎРѓРЎвЂљР Р†Р В°: {battle.proof.length}</span>
                  )}
                </div>
              </div>
            </div>

            <div className="flex items-center space-x-2">
              <button
                onClick={() => handleBattleAction(battle.id, 'resolve_dispute', battle.player1.id)}
                className="flex items-center space-x-1 px-3 py-1 rounded-lg bg-green-500 bg-opacity-20 text-green-500 hover:bg-opacity-30 text-sm"
              >
                <Crown className="w-4 h-4" />
                <span>{battle.player1.name}</span>
              </button>
              <button
                onClick={() => handleBattleAction(battle.id, 'resolve_dispute', battle.player2.id)}
                className="flex items-center space-x-1 px-3 py-1 rounded-lg bg-green-500 bg-opacity-20 text-green-500 hover:bg-opacity-30 text-sm"
              >
                <Crown className="w-4 h-4" />
                <span>{battle.player2.name}</span>
              </button>
              <button
                onClick={() => setSelectedBattle(battle)}
                className="flex items-center space-x-1 px-3 py-1 rounded-lg bg-blue-500 bg-opacity-20 text-blue-500 hover:bg-opacity-30 text-sm"
              >
                <Eye className="w-4 h-4" />
                <span>Р СџР С•Р Т‘РЎР‚Р С•Р В±Р Р…Р ВµР Вµ</span>
              </button>
            </div>
          </div>
        </div>
      ))}
    </div>
  );

  return (
    <div className="p-6 space-y-6">
      {/* Р вЂ”Р В°Р С–Р С•Р В»Р С•Р Р†Р С•Р С” */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold" style={{ color: theme === 'dark' ? '#E8ECF2' : '#0F172A' }}>
            Р Р€Р С—РЎР‚Р В°Р Р†Р В»Р ВµР Р…Р С‘Р Вµ Р В±Р В°РЎвЂљРЎвЂљР В»Р В°Р СР С‘
          </h1>
          <p className="text-sm opacity-70" style={{ color: theme === 'dark' ? '#A7B0BD' : '#6B7280' }}>
            Р СљР С•Р Т‘Р ВµРЎР‚Р В°РЎвЂ Р С‘РЎРЏ Р С—Р С•Р ВµР Т‘Р С‘Р Р…Р С”Р С•Р Р† Р С‘ РЎР‚Р ВµРЎв‚¬Р ВµР Р…Р С‘Р Вµ РЎРѓР С—Р С•РЎР‚Р С•Р Р†
          </p>
        </div>
      </div>

      {/* Р РЋРЎвЂљР В°РЎвЂљР С‘РЎРѓРЎвЂљР С‘Р С”Р В° */}
      <div className="grid grid-cols-2 md:grid-cols-6 gap-4">
        <div 
          className="p-4 rounded-xl text-center"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="text-2xl font-bold text-blue-500">{stats.totalBattles}</div>
          <div className="text-sm opacity-70">Р вЂ™РЎРѓР ВµР С–Р С•</div>
        </div>
        <div 
          className="p-4 rounded-xl text-center"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="text-2xl font-bold text-yellow-500">{stats.activeBattles}</div>
          <div className="text-sm opacity-70">Р С’Р С”РЎвЂљР С‘Р Р†Р Р…РЎвЂ№РЎвЂ¦</div>
        </div>
        <div 
          className="p-4 rounded-xl text-center"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="text-2xl font-bold text-green-500">{stats.completedBattles}</div>
          <div className="text-sm opacity-70">Р вЂ”Р В°Р Р†Р ВµРЎР‚РЎв‚¬Р ВµР Р…Р С•</div>
        </div>
        <div 
          className="p-4 rounded-xl text-center"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="text-2xl font-bold text-orange-500">{stats.disputedBattles}</div>
          <div className="text-sm opacity-70">Р РЋР С—Р С•РЎР‚Р Р…РЎвЂ№РЎвЂ¦</div>
        </div>
        <div 
          className="p-4 rounded-xl text-center"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="text-2xl font-bold text-purple-500">{stats.totalVolume}</div>
          <div className="text-sm opacity-70">Р С›Р В±РЎР‰Р ВµР С</div>
        </div>
        <div 
          className="p-4 rounded-xl text-center"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            border: theme === 'dark' ? '1px solid rgba(255,255,255,0.1)' : '1px solid #E6E9EF'
          }}
        >
          <div className="text-2xl font-bold text-indigo-500">{Math.round(stats.averageStake)}</div>
          <div className="text-sm opacity-70">Р РЋРЎР‚Р ВµР Т‘Р Р…РЎРЏРЎРЏ РЎРѓРЎвЂљР В°Р Р†Р С”Р В°</div>
        </div>
      </div>

      {/* Р СћР В°Р В±РЎвЂ№ */}
      <div className="flex space-x-2 border-b" style={{ borderColor: theme === 'dark' ? 'rgba(255,255,255,0.1)' : '#E6E9EF' }}>
        {[
          { id: 'active', label: 'Р С’Р С”РЎвЂљР С‘Р Р†Р Р…РЎвЂ№Р Вµ', icon: Activity, count: stats.activeBattles },
          { id: 'history', label: 'Р ВРЎРѓРЎвЂљР С•РЎР‚Р С‘РЎРЏ', icon: Clock, count: stats.completedBattles },
          { id: 'disputes', label: 'Р РЋР С—Р С•РЎР‚РЎвЂ№', icon: AlertTriangle, count: stats.disputedBattles }
        ].map((tab) => (
          <button
            key={tab.id}
            onClick={() => setActiveTab(tab.id as any)}
            className={`flex items-center space-x-2 px-4 py-2 border-b-2 transition-colors ${
              activeTab === tab.id 
                ? 'border-blue-500 text-blue-500' 
                : 'border-transparent opacity-70 hover:opacity-100'
            }`}
            style={{
              color: activeTab === tab.id ? '#3B82F6' : theme === 'dark' ? '#E8ECF2' : '#0F172A'
            }}
          >
            <tab.icon className="w-4 h-4" />
            <span className="font-medium">{tab.label}</span>
            {tab.count > 0 && (
              <span className="px-2 py-1 rounded-full text-xs bg-blue-500 bg-opacity-20 text-blue-500">
                {tab.count}
              </span>
            )}
          </button>
        ))}
      </div>

      {/* Р В¤Р С‘Р В»РЎРЉРЎвЂљРЎР‚РЎвЂ№ */}
      <div className="flex space-x-4">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 opacity-50" />
          <input
            type="text"
            placeholder="Р СџР С•Р С‘РЎРѓР С” Р В±Р В°РЎвЂљРЎвЂљР В»Р С•Р Р†..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-10 pr-4 py-2 rounded-lg border"
            style={{
              backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
              borderColor: theme === 'dark' ? 'rgba(255,255,255,0.2)' : '#E6E9EF',
              color: theme === 'dark' ? '#E8ECF2' : '#0F172A'
            }}
          />
        </div>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-2 rounded-lg border"
          style={{
            backgroundColor: theme === 'dark' ? '#1C2029' : '#FFFFFF',
            borderColor: theme === 'dark' ? 'rgba(255,255,255,0.2)' : '#E6E9EF',
            color: theme === 'dark' ? '#E8ECF2' : '#0F172A'
          }}
        >
          <option value="all">Р вЂ™РЎРѓР Вµ РЎРѓРЎвЂљР В°РЎвЂљРЎС“РЎРѓРЎвЂ№</option>
          {Object.entries(BATTLE_STATUS).map(([value, status]) => (
            <option key={value} value={value}>{status.label}</option>
          ))}
        </select>
      </div>

      {/* Р С™Р С•Р Р…РЎвЂљР ВµР Р…РЎвЂљ */}
      {activeTab === 'active' && renderActiveBattles()}
      {activeTab === 'history' && renderBattleHistory()}
      {activeTab === 'disputes' && renderDisputes()}
    </div>
  );
};
