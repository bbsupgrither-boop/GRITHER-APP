import { promises as fs } from 'fs';
import { glob } from 'glob';
import iconv from 'iconv-lite';

// –°–ª–æ–≤–∞—Ä—å –∑–∞–º–µ–Ω –∫—Ä–∞–∫–æ–∑—è–±—Ä –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞
const cyrillicReplacements = {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã
  '–† –í –†'–í–† –í –† –≤–Ç –† –í –†'–í¬∞–† –í –† –≤–Ç¬¶ –† –í –†'–í–† –í –† –≤–Ç –† –í –†'–í¬∞–† –í –† –≤–Ç¬¶–† –í –†–é–≤–Ç—û–† –í –† –≤–Ç ': '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',
  '–† –í –†–é–°—ô–† –í –†–é–≤–Ç—û–† –í –† –≤–Ç –† –í –†–é–≤–Ç–† –†–ã–†–Ü–†‚Äö–†–ã–† –í –†–é–≤–Ç—û–† –í –†–é–≤–Ç—ú': '–ù–æ–≤–∏—á–æ–∫',
  '–† –í –†–Ü–†‚Äö–°—ö–† –í –†–é–≤–Ç—û–† –†–ã–† –°"–† –†–ã–†–Ü–†‚Äö–°‚Ñ¢–† –í –†–é–≤–Ç–† –í –†–é–≤–Ç"–† –í –† –≤–Ç¬¶–† –í –†–é–≤–Ç–† –†–ã–†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í¬µ 2 –† –†–ã–†–é–≤–Ç—ö–† –†–ã–† –≤–Ç—ô–† –í –†–é–≤–Ç—û–† –í –† –≤–Ç –† –í –† –≤–Ç¬¶–† –†–ã–† –†–è': '–î–æ—Å—Ç–∏—á—å 2 —É—Ä–æ–≤–Ω—è',
  '–† –í –†–é–°‚Ä∫–† –†–ã–† –≤–Ç—ô–† –†–ã–†–é–≤–Ç—ö–† –í –†—û–≤–Ç–† –í –†–é–≤–Ç—û–† –í –†'–í¬ª–† –†–ã–† –≤–Ç‚Ññ–† –í –†'–í–† –í –†–é–≤–Ç–† –í –† –≤–Ç –† –†–ã–†–Ü–†‚Äö–≤‚Äû‚Äì–† –í –†–Ü–≤–Ç—õ–≤–Ç"': '–í—ã–ø–æ–ª–Ω–∏—Ç–µ–ª—å',
  '–† –í –†–Ü–†‚Äö–≤‚Äû—û–† –†–ã–†–Ü–†‚Äö–≤‚Äû‚Äì–† –í –†–é–≤–Ç"–† –í –†–é–≤–Ç—û–† –í –†'–í¬ª–† –í –† –≤–Ç¬¶–† –í –†–é–≤–Ç–† –†–ã–†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í¬µ 10 –† –í –†'–í¬∑–† –í –†'–í¬∞–† –í –†—û–≤–Ç–† –í –†'–í¬∞–† –†–ã–†–Ü–†‚Äö–†–ã': '–í—ã–ø–æ–ª–Ω–∏—Ç—å 10 –∑–∞–¥–∞–Ω–∏–π',
  '–† –í –†–é–≤‚Äû—û–† –í –†–é–≤–Ç—û–† –í –†'–í–† –í –†'–í¬ª–† –í –†'–í¬µ–† –í –†–é–≤–Ç—ú–† –†–ã–†–Ü–†‚Äö–í –† –í –†–é–≤–Ç–† –í –†–é–≤–Ç—û–† –í –† –≤–Ç –† –í –†'–í¬µ–† –†–ã–† –≤–Ç—ô': '–£–¥–∞—á–ª–∏–≤—ã–π',
  '–† –í –†–é–≤–Ç—î–† –†–ã–†–Ü–†‚Äö–°‚Ñ¢–† –í –†–é–≤–Ç—ú–† –†–ã–† –≤–Ç—ô–† –í –†–é–≤–Ç—û–† –í –†–Ü–≤–Ç—õ–≤–Ç"–† –†–ã–†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í¬µ 5 –† –í –†–é–≤–Ç—ú–† –í –†'–í¬µ–† –í –†–Ü–≤–Ç—õ–≤–Ç"–† –†–ã–† –°"–† –í –†–é–≤–Ç—û–† –í –† –≤–Ç ': '–û—Ç–∫—Ä—ã—Ç—å 5 –∫–µ–π—Å–æ–≤',
  
  // –ò–º–µ–Ω–∞
  '–† –í –†'–í–† –†‚Ä†–† –≤–Ç—ô–†–é–°‚Ä∫–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬ª–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬µ–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞ –† –í –†'–í–† –†–ã–†–é–≤‚Äû—û–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –† –†‚Äπ–† –í –†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∑–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞': '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü–µ—Ç—Ä–æ–≤–∏—á',
  '–† –í –†'–í–† –†–ã–†–é–≤‚Äû—û–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –† –†‚Äπ–† –í –†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–í¬¶–† –í –† –†‚Äπ–† –í –† –†–è –† –í –†'–í–† –í –† –≤–Ç‚Ññ–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –°—õ–†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –† –†‚Äπ–† –í –†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞': '–ú–∞—Ä–∏—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞',
  '–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–≤‚Äû—û–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞ –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞': '–î–º–∏—Ç—Ä–∏–π –ù–∏–∫–æ–ª–∞–µ–≤–∏—á',
  
  // –û–±—â–∏–µ —Å–ª–æ–≤–∞
  '–† –í –†'–í–† –†‚Ä†–† –≤–Ç—ô–†–Ü–≤–Ç—õ–°—õ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬µ–† –í –†'–í–† –†‚Ä†–†–Ü–†‚Äö–°‚Ä∫–†–Ü–†‚Äö–≤–Ç—ö': '–ö–µ–π—Å',
  '–† –í –†'–í–† –í –† –≤–Ç‚Ññ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬ª–† –í –† –†‚Äπ–† –†–ã–†–Ü–†‚Äö–°—ô–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–† –†‚Äπ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –†'–í–† –†‚Ä†–†–Ü–†‚Äö–°‚Ä∫–†–Ü–†‚Äö–≤–Ç—ö–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–†–Ü–≤–Ç—õ–≤–Ç"–† –í –†'–í–† –†‚Ä†–†–Ü–†‚Äö–°‚Ä∫–†–Ü–†‚Äö–≤–Ç—ö –† –í –†'–í–† –†–ã–†–Ü–†‚Äö–≤–Ç—ú–† –í –† –†‚Äπ–† –í –†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬µ–† –í –†'–í–† –°—õ–†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –†–ã–†'–í–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬µ–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–†–é–≤‚Äû—û': '–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏',
  '–† –í –†–é–°—ô–† –í –†–é–≤–Ç—û–† –í –† –≤–Ç –† –í –†–é–≤–Ç—û–† –í –†'–í¬µ': '–ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ',
  '–† –í –† –†–É –† –í –† –≤–Ç –† –í –†'–í¬∞–† –†–ã–† –°" –† –í –† –≤–Ç¬¶–† –í –†–é–≤–Ç—û–† –í –† –≤–Ç –† –í –†–é–≤–Ç—û–† –í –†'–í¬µ –† –†–ã–† –°"–† –í –†–é–≤–Ç—û–† –í –†–é–≤–Ç—û–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–í¬∞–† –í –†'–í¬µ–† –í –† –≤–Ç¬¶–† –í –†–é–≤–Ç–† –í –†'–í¬µ': '–í—ã –ø–æ–ª—É—á–∏–ª–∏ –Ω–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ',
  
  // –ö–æ–º–∞–Ω–¥—ã
  '–† –í –†'–í–† –†‚Ä†–† –≤–Ç—ô–†–Ü–≤–Ç—õ–°—õ–† –í –† –†‚Äπ–† –í –†–é–≤–Ç—ö–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬µ –† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—ö–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –†–ã–†'–í–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –°—õ–†–Ü–†‚Äö–í¬¶–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–†–Ü–≤–Ç—õ–≤–Ç"': '–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã',
  '–† –í –†'–í–† –í –† –≤–Ç‚Ññ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–≤–Ç—ú–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–≤–Ç—ú–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –† –†‚Äπ–† –í –†–Ü–†‚Äö–°‚Ñ¢–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–†–é–≤‚Äû—û': '–í—ã–±—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—É',
  '–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í–† –í –† –†‚Äπ–† –†–ã–†–Ü–†‚Äö–°—ô–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—ö–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –°—õ–†–Ü–†‚Äö–í¬¶–† –í –† –†‚Äπ–† –í –†–é–≤–Ç—ö–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–†–é–≤‚Äû—û–† –í –†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ': '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞',
  
  // –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  '–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°"–† –í –† –†‚Äπ–† –†‚Ä†–†–Ü–†‚Äö–°‚Ñ¢–†'–í¬¨–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬±–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—ö–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞ –† –í –†'–í–† –†–ã–†–Ü–†‚Äö–≤–Ç—ú–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬ª–† –í –† –†‚Äπ–† –†–ã–†–Ü–†‚Äö–°—ô–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–† –†‚Äπ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬µ–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–í¬¶–† –í –† –†‚Äπ–† –í –† –†–è –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–†–é–≤‚Äû—û–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –† –†‚Äπ–† –í –†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—ö–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–í¬¶': '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
  '–† –†–ã–† –≤–Ç—ô–† –†–ã–†–é–°—ü–† –†‚Ä†–† –≤–Ç—ô–†–é–°—ô–† –í –† –†‚Ä∞ –† –í –†'–í–† –†–ã–†–é–°—ü–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—õ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬ª–† –í –† –†‚Äπ–† –†–ã–†–Ü–†‚Äö–°—ô–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–† –†‚Äπ–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬µ–† –í –†'–í–† –í –†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞ –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –†'–í–† –í –†–Ü–†‚Äö–í –† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –† –†‚Äπ–† –†‚Ä†–† –≤–Ç—ô–†–é–≤‚Äû—û–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞–† –í –† –†‚Äπ–† –í –†–Ü–†‚Äö–°‚Ñ¢–† –í –†'–í–† –†–ã–†–Ü–†‚Äö–°—ö–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬∞ –† –í –†'–í–† –°—õ–†–Ü–†‚Äö–í¬¶–† –í –†'–í–† –≤–Ç‚Ñ¢–†'–í¬ª–† –í –† –†‚Äπ–† –í –† –†–è Telegram ID': '–û–±–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram ID'
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Ç–µ–∫—Å—Ç –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã
function hasCyrillicGarbled(text) {
  const garbledPatterns = [
    /–† –í –†'–í/g,  // –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω –∫—Ä–∞–∫–æ–∑—è–±—Ä
    /–†–é–°—ô/g,     // –î—Ä—É–≥–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω
    /–†–Ü–†‚Äö–°—ö/g,   // –ï—â–µ –æ–¥–∏–Ω –ø–∞—Ç—Ç–µ—Ä–Ω
    /–† –†–ã–†/g,    // –ü–∞—Ç—Ç–µ—Ä–Ω —Å –† –†–ã–†
    /√ê/g,        // –õ–∞—Ç–∏–Ω—Å–∫–∏–µ –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã
    /√ë/g,        // –õ–∞—Ç–∏–Ω—Å–∫–∏–µ –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã
    /–† –°‚Äî–†'–í¬ª–†–é–≤–Ç"import/g  // –ò—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
  ];
  
  return garbledPatterns.some(pattern => pattern.test(text));
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
function fixCyrillicText(text) {
  let fixed = text;
  
  // –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–∞–º–µ–Ω—ã –∏–∑ —Å–ª–æ–≤–∞—Ä—è
  for (const [broken, correct] of Object.entries(cyrillicReplacements)) {
    if (fixed.includes(broken)) {
      fixed = fixed.replaceAll(broken, correct);
    }
  }
  
  // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∏—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
  if (fixed.includes('–† –°‚Äî–†'–í¬ª–†–é–≤–Ç"import')) {
    fixed = fixed.replace('–† –°‚Äî–†'–í¬ª–†–é–≤–Ç"import', 'import');
  }
  
  // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É
  if (hasCyrillicGarbled(fixed)) {
    try {
      // –ö–æ–¥–∏—Ä—É–µ–º –≤ CP1251 –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º –∫–∞–∫ UTF-8
      const recoded = iconv.decode(iconv.encode(fixed, 'win1251'), 'utf8');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ä—É—Å—Å–∫–∏—Ö –±—É–∫–≤ —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ
      const originalCyrillic = (fixed.match(/[–ê-–Ø–∞-—è–Å—ë]/g) || []).length;
      const recodedCyrillic = (recoded.match(/[–ê-–Ø–∞-—è–Å—ë]/g) || []).length;
      
      if (recodedCyrillic > originalCyrillic && !hasCyrillicGarbled(recoded)) {
        fixed = recoded;
      }
    } catch (error) {
      console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏:', error.message);
    }
  }
  
  return fixed;
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function fixAllCyrillicFiles() {
  console.log('üîß –ù–∞—á–∏–Ω–∞—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∞–∫–æ–∑—è–±—Ä –≤ –ø—Ä–æ–µ–∫—Ç–µ...\n');
  
  // –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  const extensions = ['ts', 'tsx', 'js', 'jsx', 'html', 'css', 'json', 'md'];
  const globPattern = `**/*.{${extensions.join(',')}}`;
  
  // –ò—Å–∫–ª—é—á–∞–µ–º node_modules, dist, .git –∏ –¥—Ä—É–≥–∏–µ —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–∞–ø–∫–∏
  const files = await glob(globPattern, {
    ignore: [
      '**/node_modules/**',
      '**/dist/**',
      '**/.git/**',
      '**/coverage/**',
      '**/*.min.js',
      '**/*.min.css'
    ],
    nodir: true
  });
  
  console.log(`üìÅ –ù–∞–π–¥–µ–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n`);
  
  const fixedFiles = [];
  const errors = [];
  
  for (const file of files) {
    try {
      const content = await fs.readFile(file, 'utf8');
      
      if (hasCyrillicGarbled(content)) {
        const originalContent = content;
        const fixedContent = fixCyrillicText(content);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–∏ —Ç–µ–∫—Å—Ç
        const originalCyrillic = (originalContent.match(/[–ê-–Ø–∞-—è–Å—ë]/g) || []).length;
        const fixedCyrillic = (fixedContent.match(/[–ê-–Ø–∞-—è–Å—ë]/g) || []).length;
        
        if (fixedCyrillic > originalCyrillic || !hasCyrillicGarbled(fixedContent)) {
          await fs.writeFile(file, fixedContent, 'utf8');
          fixedFiles.push({
            file,
            originalCyrillic,
            fixedCyrillic,
            improvement: fixedCyrillic - originalCyrillic
          });
          console.log(`‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω: ${file} (+${fixedCyrillic - originalCyrillic} –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)`);
        }
      }
    } catch (error) {
      errors.push({ file, error: error.message });
      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ ${file}:`, error.message);
    }
  }
  
  // –û—Ç—á–µ—Ç
  console.log('\nüìä –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–•:');
  console.log('='.repeat(50));
  console.log(`üìÅ –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${files.length}`);
  console.log(`‚úÖ –§–∞–π–ª–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: ${fixedFiles.length}`);
  console.log(`‚ùå –û—à–∏–±–æ–∫: ${errors.length}`);
  
  if (fixedFiles.length > 0) {
    console.log('\nüìù –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:');
    fixedFiles.forEach(({ file, improvement }) => {
      console.log(`  ‚Ä¢ ${file} (+${improvement} —Å–∏–º–≤–æ–ª–æ–≤)`);
    });
  }
  
  if (errors.length > 0) {
    console.log('\n‚ùå –û–®–ò–ë–ö–ò:');
    errors.forEach(({ file, error }) => {
      console.log(`  ‚Ä¢ ${file}: ${error}`);
    });
  }
  
  console.log('\nüéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
  
  if (fixedFiles.length > 0) {
    console.log('\nüí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:');
    console.log('1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ');
    console.log('2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ npm run dev –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã');
    console.log('3. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞');
  }
}

// –ó–∞–ø—É—Å–∫
fixAllCyrillicFiles().catch(console.error);
